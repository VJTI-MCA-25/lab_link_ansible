{% extends 'main.html' %}
{% load static %}
{% block content %}
<div class="container">
    <div class="row">
        <div class="col right">
            <button class="refresh-list-button btn waves-effect waves-light" type="submit" name="action">Refresh List
                <i class="material-icons left">refresh</i>
              </button>            
        </div>
    </div>
</div>
<div class="hosts-container"></div>
<script type="module" defer>
    import { ping_hosts } from "{% static 'scripts/fetch.js' %}";

    const container = document.querySelector('.hosts-container');

    async function getHosts() {
        updateLoadingState(true);
        const data = await ping_hosts();
        updateLoadingState(false);
        populateHosts(data);
    }

    function updateLoadingState(isLoading = False) {
        if (isLoading) {
            container.innerHTML = `{% include 'preloader.html' with subtext=True %}`;
        } else {
            container.innerHTML = '';
        }
    }

    function populateHosts(data) {
        let hosts = Object.keys(data);

        hosts.forEach((host) => {
            let div = document.createElement('div');
            div.classList.add('host');
            div.innerHTML = `
                <div class="${data[host]} host-status"></div>
                <div class="host-name">${host}</div>
            `;
            container.appendChild(div);
        })
    }

    getHosts();

    document.querySelector('.refresh-list-button').addEventListener('click', getHosts);

</script>
{% endblock content %}